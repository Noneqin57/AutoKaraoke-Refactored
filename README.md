# AutoKaraoke Refactored

一个基于Whisper将已有行时间轴的歌词转换为逐字歌词的Python程序。

> 💡 这是本人的第一次vibe coding尝试

## ✨ 主要功能

### 🎵 核心功能
- **拖拽上传**: 支持直接拖拽歌曲/歌词文件到界面
- **字级打轴**: 基于Whisper对每句话进行进一步的字级时间轴生成
- **强制校准**: 当生成时间戳与原始时间戳偏差过大时自动对齐
- **手动校准**: 提供可视化编辑器进行精确调整

### 📝 支持格式
- **音频格式**: MP3, WAV, FLAC, M4A, OGG
- **歌词格式**: LRC, TXT, SRT
- **输出格式**: LRC（兼容foobar2000卡拉OK歌词）

## 🚀 快速开始

### 环境要求
- Python 3.8+
- Windows 10/11
- 推荐：NVIDIA GPU + CUDA

### 安装步骤

1. **安装依赖**
```bash
pip install -r requirements.txt
```

2. **运行程序**
```bash
python main.py
```

## 📖 使用指南

### 基本工作流程

1. **导入文件**
   - 直接拖拽音频文件和歌词文件到界面
   - ⚠️ **注意**: 不要拖拽到文本框内，会将对应路径拖拽上去导致失效

2. **开始处理**
   - 点击"🚀 开始生成"开始AI处理
   - 等待Whisper识别和字级打轴完成

3. **校准调整**
   - 查看生成结果，如有误差可启用"强制校准"模式
   - 或使用"🛠️ 手动校准/编辑"进行精确调整

4. **保存结果**
   - 点击"💾 保存结果"保存为LRC文件

### 强制校准说明

- **默认阈值**: 1.5秒（只纠正极大误差）
- **调整方法**: 修改 `lrc_aligner.py` 中的 `if abs(diff) > 1.5`
- **适用场景**: 适合处理已有时间轴的歌词文件

## 💡 使用建议

### 🎤 音频处理
- **人声分离**: 虽然Whisper在有伴奏情况下也能打轴，但建议先进行人声分离，导入纯人声会减少误判
- **音质要求**: 清晰的人声录音效果更佳

### 📝 歌词选择
- **推荐来源**: 尽量选择网易云歌词（项目以网易云歌词为基础编写和测试）
- **格式要求**: 支持标准的LRC格式时间戳

### 🎵 兼容性
- **播放器**: 输出的LRC文件可被foobar2000正常读取与输出卡拉OK歌词
- **其他播放器**: 未测试其他音乐流媒体的适配程度

## 🏗️ 项目结构

```
REATK/
├── main.py                 # 应用程序入口
├── config.py              # 配置管理
├── requirements.txt       # 依赖包列表
├── ui/                    # 用户界面
│   ├── main_window.py     # 主窗口
│   ├── settings_dialog.py # 设置对话框
│   ├── editor_dialog.py   # 编辑对话框
│   └── word_editor.py     # 单词编辑器
├── core/                  # 核心功能
│   ├── whisper_worker.py  # Whisper工作进程
│   ├── lrc_parser.py      # LRC解析器
│   └── lrc_aligner.py     # 歌词对齐器
├── utils/                 # 工具模块
│   ├── logger.py          # 日志工具
│   └── time_utils.py      # 时间工具
└── 原歌词/                # 示例歌词文件
```

## 🔧 技术特点

### 核心算法
- **Whisper集成**: 使用OpenAI Whisper进行语音识别
- **字级对齐**: 基于AI识别结果进行精确的字级时间轴生成
- **智能校准**: 自动检测和纠正时间戳偏差
- **边界约束**: 防止时间戳溢出和重叠

### 性能优化
- **多进程架构**: 后台常驻进程，避免重复加载模型
- **模型缓存**: 智能缓存机制提高处理效率
- **进度监控**: 实时显示处理进度

## 🐛 已知限制

- **人声要求**: 目前算法主要支持大部分无重叠人声的歌曲
- **时间误差**: 输出的歌词与输入的歌词之间仍有些许误差
- **语言支持**: 主要针对中文歌词优化

## 🔮 未来计划

### 即将推出
1. **人声分离集成**: 将MSST/UVR人声分离功能嵌入整体程序
2. **歌词搜索**: 将歌词搜寻功能嵌入整体程序
3. **算法优化**: 更精准的对齐算法

### 长期目标
- 支持更多音频格式和语言
- 改进多声部歌曲的处理能力
- 提供更多自定义选项

## 📄 许可证

本项目采用 MIT 许可证。

## 🙏 致谢

- [OpenAI Whisper](https://github.com/openai/whisper) - 语音识别模型
- [PyQt6](https://www.riverbankcomputing.com/software/pyqt/) - GUI框架

---

**AutoKaraoke Refactored** - 让歌词打轴更简单！ 🎵
