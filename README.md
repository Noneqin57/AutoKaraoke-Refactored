# REATK: 基于Whisper的逐字歌词生成器

一个功能强大的Python桌面应用程序，利用OpenAI Whisper模型将已有行时间轴的歌词转换为精确的逐字歌词。REATK旨在简化歌词制作流程，为卡拉OK爱好者和歌词创作者提供高效工具。

## ✨ 主要功能

### 🎵 核心功能
- **图形用户界面 (GUI)**: 提供直观友好的操作界面。
- **拖拽上传**: 支持直接拖拽歌曲/歌词文件到界面，操作便捷。
- **逐字打轴**: 基于Whisper对每句话进行进一步的字级时间轴生成，实现高精度歌词对齐。
- **智能校准**: 当生成时间戳与原始时间戳偏差过大时自动对齐，提高准确性。
- **手动编辑**: 提供可视化编辑器，支持对逐字时间轴进行精确的手动调整。

### 📝 支持格式
- **音频格式**: MP3, WAV, FLAC, M4A, OGG
- **歌词格式**: LRC, TXT, SRT
- **输出格式**: LRC（兼容foobar2000卡拉OK歌词及其他支持逐字歌词的播放器）

## 🚀 快速开始

### 环境要求
- Python 3.8+
- Windows 10/11
- 推荐：NVIDIA GPU + CUDA（大幅提升Whisper处理速度）

### 安装步骤

1. **安装依赖**
```bash
pip install -r requirements.txt
```

2. **运行程序**
```bash
python main.py
```
程序将启动图形用户界面。

## 📖 使用指南

### 基本工作流程

1. **导入文件**
   - 启动程序后，将音频文件（如 `.mp3`）和歌词文件（如 `.lrc`）直接拖拽到界面指定区域。
   - ⚠️ **注意**: 请确保拖拽到正确的区域，避免拖拽到文本框内导致路径失效。

2. **开始处理**
   - 点击界面上的"🚀 开始生成"按钮，程序将调用Whisper模型进行语音识别和逐字时间轴生成。
   - 处理过程中，界面会实时显示进度。

3. **校准与编辑**
   - 处理完成后，结果将显示在界面上。
   - 如有需要，可以勾选"强制校准"选项，程序将自动调整时间戳偏差较大的部分。
   - 点击"🛠️ 手动校准/编辑"按钮，将打开可视化编辑器，您可以逐字调整歌词的时间轴，确保完美同步。

4. **保存结果**
   - 确认无误后，点击"💾 保存结果"按钮，将生成的逐字LRC歌词文件保存到指定位置。

### 强制校准说明

- **默认阈值**: 1.5秒（程序只纠正生成时间与原始时间偏差超过1.5秒的行）。
- **自定义阈值**: 用户可在设置中调整该阈值。
- **适用场景**: 适合处理已有时间轴的歌词文件，对齐可能存在的较大误差。

## 💡 使用建议

### 🎤 音频处理
- **人声分离**: 建议在处理前对歌曲进行人声分离，导入纯人声文件可以显著提高Whisper的识别准确率，减少误判。
- **音质要求**: 清晰、无背景噪音的人声录音能带来最佳的识别效果。

### 📝 歌词选择
- **推荐来源**: 尽量选择高质量、准确的歌词文本。本项目以网易云歌词为基础进行开发和测试，兼容性良好。
- **格式要求**: 支持标准的LRC格式时间戳，也支持纯文本歌词（程序会自动按行拆分）。

### 🎵 兼容性
- **播放器**: 输出的LRC文件经过优化，可被foobar2000等支持卡拉OK歌词的播放器正常读取并显示逐字效果。
- **其他播放器**: 欢迎测试并反馈与其他音乐流媒体或播放器的适配情况。

## 🏗️ 项目结构

```
REATK/
├── main.py                 # 应用程序入口，启动GUI
├── config.py               # 配置文件，管理程序设置
├── requirements.txt        # Python依赖包列表
├── README.md               # 项目说明文档
├── .gitignore              # Git忽略文件配置
├── settings.json.example   # 设置文件示例
├── ui/                     # 用户界面模块
│   ├── main_window.py      # 主窗口界面逻辑
│   ├── editor_dialog.py    # 逐字歌词编辑对话框
│   ├── settings_dialog.py  # 程序设置对话框
│   └── word_editor.py      # 单词级编辑器组件
├── core/                   # 核心逻辑模块
│   ├── whisper_worker.py   # Whisper模型处理工作进程/线程
│   ├── lrc_parser.py       # LRC歌词解析与生成
│   └── lrc_aligner.py      # 歌词时间轴对齐算法
├── utils/                  # 工具函数模块
│   ├── logger.py           # 日志记录工具
│   └── time_utils.py       # 时间处理工具
└── LRC/                    # 示例歌词文件存放目录 (可选)
```

## 🔧 技术特点

### 核心算法
- **Whisper集成**: 深度整合OpenAI Whisper模型进行高效准确的语音识别。
- **逐字对齐**: 基于AI识别结果和LRC原始时间轴，生成精细到每个字的准确时间戳。
- **智能边界约束**: 优化时间戳生成逻辑，防止歌词溢出和重叠，确保时间轴的合理性。

### 性能优化
- **多进程/线程架构**: 将耗时的Whisper处理放到独立的后台工作进程/线程中，避免主界面卡顿。
- **模型缓存**: 智能管理Whisper模型加载，减少重复加载时间，提升后续处理效率。
- **实时进度反馈**: 界面实时显示处理进度和状态，提供良好的用户体验。

## 🐛 已知限制

- **人声要求**: 目前算法主要针对单声部或主要人声清晰的歌曲优化，对复杂多重人声歌曲的处理效果可能受限。
- **时间误差**: 尽管经过多重校准，输出的歌词与输入的歌词之间仍可能存在微小时间误差，部分需手动精调。
- **语言支持**: 主要针对中文歌词进行优化和测试，对其他语言的识别和对齐效果有待进一步验证。

## 🔮 未来计划

### 即将推出
1. **人声分离集成**: 考虑将Spleeter/UVR等先进人声分离功能直接集成到程序中，提供一站式解决方案。
2. **歌词搜索与下载**: 增加在线歌词搜索和下载功能，方便用户获取歌词。
3. **算法优化**: 持续改进逐字对齐算法，提高精度和鲁棒性。

### 长期目标
- 支持更多音频格式和更广泛的语种。
- 进一步优化多声部或复杂背景音乐下的处理能力。
- 提供更丰富的自定义选项和高级编辑功能。

## 📄 许可证

本项目采用 MIT 许可证。

## 🙏 致谢

- [OpenAI Whisper](https://github.com/openai/whisper) - 强大的语音识别模型
- [PyQt6](https://www.riverbankcomputing.com/software/pyqt/) - 构建高效桌面GUI的卓越框架

---

**REATK** - 让逐字歌词制作触手可及！ 🎵
